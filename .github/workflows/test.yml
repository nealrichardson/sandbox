name: PR Comment Workflow Triggers

on:
  push:

jobs:
  testing:
    runs-on: ubuntu-latest

    steps:
      - name: test mirrors
        run: |
          set -e

          RUNS=3

          test_mirror() {
            local name=$1
            local mirror=$2

            echo "=== $name ==="

            # Set the mirror
            sudo sed -i "s|http://[^/]*.ubuntu.com|$mirror|g" /etc/apt/sources.list

            total=0
            for i in $(seq 1 $RUNS); do
              sudo rm -rf /var/lib/apt/lists/*
              start=$(date +%s.%N)
              sudo apt-get update -qq
              end=$(date +%s.%N)
              time_taken=$(echo "$end - $start" | bc)
              echo "  Run $i: ${time_taken}s"
              total=$(echo "$total + $time_taken" | bc)
            done
            avg=$(echo "scale=2; $total / $RUNS" | bc)
            echo "  Average: ${avg}s"
            echo ""
          }

          test_mirror "Default (archive.ubuntu.com)" "http://archive.ubuntu.com"
          test_mirror "EC2 mirror" "http://us-east-1.ec2.archive.ubuntu.com"
